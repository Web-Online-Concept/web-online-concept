import { NextResponse } from 'next/server'

// Configuration de l'assistant Florent
const FLORENT_CONTEXT = `Tu es Florent, consultant digital senior chez Web Online Concept. Voici ton profil et tes connaissances :

PERSONNALIT√â :
- Homme de 38 ans, expert en transformation digitale
- Professionnel mais accessible, tu tutoies ou vouvoies selon le contexte
- Passionn√© par ton m√©tier, tu aimes partager tes connaissances
- Tu es positif et orient√© solutions

EXPERTISE WEB ONLINE CONCEPT :
- Sp√©cialiste en cr√©ation de sites web professionnels
- Expert en r√©f√©rencement SEO et performance web
- Ma√Ætrise des technologies modernes : Next.js, React, Node.js
- Exp√©rience en e-commerce, sites vitrines, applications web

NOS SERVICES ET TARIFS :
1. Site Vitrine (497‚Ç¨) :
   - 5 pages optimis√©es SEO
   - Design responsive moderne
   - Formulaire de contact
   - H√©bergement 1 an inclus
   - Livraison en 7 jours

2. Site E-commerce (997‚Ç¨) :
   - Boutique compl√®te WooCommerce/Shopify
   - Paiement s√©curis√©
   - Gestion des stocks
   - Formation incluse
   - Livraison en 14 jours

3. Site Sur Mesure (√† partir de 1497‚Ç¨) :
   - D√©veloppement personnalis√©
   - Fonctionnalit√©s avanc√©es
   - Int√©grations API
   - Support prioritaire

AVANTAGES CLIENTS :
- Devis gratuit en 24h
- Satisfaction garantie
- Support technique inclus 3 mois
- Formation √† la gestion du site
- Optimisation SEO de base incluse

DIRECTIVES :
- R√©ponds de mani√®re concise mais compl√®te
- Utilise des exemples concrets quand c'est pertinent
- Si on te pose une question hors web, r√©ponds bri√®vement puis ram√®ne vers nos services
- Propose naturellement un devis gratuit quand c'est appropri√©
- Reste professionnel mais chaleureux`

export async function POST(request) {
  try {
    const { message } = await request.json()

    // Pour le d√©veloppement, on utilise une r√©ponse simul√©e
    // En production, vous devrez int√©grer l'API Claude ici
    
    // TODO: Remplacer par l'appel r√©el √† Claude API
    /*
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'x-api-key': process.env.CLAUDE_API_KEY,
        'anthropic-version': '2023-06-01'
      },
      body: JSON.stringify({
        model: 'claude-3-opus-20240229',
        max_tokens: 1024,
        messages: [
          {
            role: 'system',
            content: FLORENT_CONTEXT
          },
          {
            role: 'user',
            content: message
          }
        ]
      })
    })
    
    const data = await response.json()
    const aiResponse = data.content[0].text
    */

    // R√©ponses simul√©es pour le d√©veloppement
    const simulatedResponses = {
      'bonjour': `Bonjour ! Ravi de vous rencontrer. Je suis Florent, consultant digital chez Web Online Concept. Je suis l√† pour vous accompagner dans votre projet web. 

Que ce soit pour cr√©er un site vitrine, une boutique en ligne ou une application sur mesure, je peux vous conseiller la meilleure solution adapt√©e √† vos besoins et votre budget.

Quel type de projet avez-vous en t√™te ?`,
      
      'tarif': `Nos tarifs sont tr√®s comp√©titifs et transparents :

üì± Site Vitrine √† 497‚Ç¨ : Parfait pour pr√©senter votre activit√©, avec 5 pages optimis√©es et un design moderne.

üõçÔ∏è E-commerce √† 997‚Ç¨ : Une boutique compl√®te pour vendre en ligne, avec paiement s√©curis√© et gestion des stocks.

‚ö° Sur Mesure d√®s 1497‚Ç¨ : Pour des besoins sp√©cifiques avec des fonctionnalit√©s avanc√©es.

Tous nos sites incluent l'h√©bergement 1 an et 3 mois de support. Voulez-vous un devis personnalis√© gratuit ?`,
      
      'd√©lai': `Nos d√©lais sont parmi les plus rapides du march√© :

‚Ä¢ Site Vitrine : 7 jours ouvr√©s
‚Ä¢ Site E-commerce : 14 jours ouvr√©s  
‚Ä¢ Site Sur Mesure : 21 √† 30 jours selon la complexit√©

Nous respectons toujours nos engagements de d√©lais. D'ailleurs, nous pouvons commencer votre projet d√®s cette semaine si vous le souhaitez !`
    }

    // Chercher une r√©ponse correspondante ou r√©ponse par d√©faut
    let responseText = simulatedResponses['bonjour'] // R√©ponse par d√©faut
    
    const lowerMessage = message.toLowerCase()
    for (const [key, value] of Object.entries(simulatedResponses)) {
      if (lowerMessage.includes(key)) {
        responseText = value
        break
      }
    }

    // TODO: Int√©grer ElevenLabs pour la g√©n√©ration audio
    // Pour l'instant, on utilisera la synth√®se vocale du navigateur
    
    return NextResponse.json({
      response: responseText,
      // audioUrl: null // Sera ajout√© avec ElevenLabs
    })
    
  } catch (error) {
    console.error('Erreur API:', error)
    return NextResponse.json(
      { error: 'Une erreur est survenue' },
      { status: 500 }
    )
  }
}